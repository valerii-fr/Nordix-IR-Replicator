# Android Client

Android-приложение для взаимодействия с IR Bridge (ESP32).  
Приложение подключается к устройству по BLE, принимает захваченные ИК-кадры, позволяет их просматривать, проверять и сохранять в виде пультов и команд.

## Назначение

- Подключение к IR Bridge по Bluetooth Low Energy
- Приём ИК-кадров в виде массива интервалов (`IntArray`)
- Визуализация и проверка принятых команд
- Сохранение команд в локальной базе данных
- Повторная отправка ИК-команд через подключённое устройство

## Архитектура

Проект построен с упором на модульность и тестируемость:

- **UI** — Jetpack Compose
- **State management** — ViewModel + Flow
- **DI** — Koin
- **BLE** — собственный BLE-клиент с подпиской на notify-характеристику
- **Persistence** — Room
- **Serialization** — Kotlinx Serialization (для экспорта / импорта команд)

## Основные модули

- `ble` — работа с BLE, подключение, MTU, приём пакетов
- `ir` — модели ИК-кадров, нормализация и округление интервалов
- `remotes` — логика пультов и команд
- `ui` — Compose-экраны и компоненты
- `data` — репозитории и локальное хранилище

## Формат ИК-данных

ИК-кадр представлен как массив длительностей (в микросекундах):

```kotlin
IntArray
```

Перед сохранением допускается нормализация интервалов (округление к ближайшему шагу) для повышения стабильности повторов.

## Требования

- Android 9.0+ (API 28+)
- Поддержка BLE
- - Разрешения:
- - BLUETOOTH
- - BLUETOOTH_ADMIN
- - BLUETOOTH_CONNECT
- - BLUETOOTH_SCAN
- - ACCESS_COARSE_LOCATION
- - ACCESS_FINE_LOCATION
- - TRANSMIT_IR

## Сборка и запуск

- Открыть проект в Android Studio
- Синхронизировать Gradle
- Запустить на реальном устройстве с BLE
- Включить IR Bridge и дождаться подключения

## Ограничения и допущения

Приложение не хранит ИК-коды на стороне ESP32 — устройство выступает как capture/emit bridge

Протокол передачи — поток notify-пакетов, не гарантирует доставку вне активного соединения

Повторы ИК-кадров зависят от точности таймингов ESP32 и выбранного шага округления

## Статус

Проект находится в активной разработке.
API и внутренняя структура могут изменяться.

## Ссылки
[ESP32-C3 firmware](https://github.com/valerii-fr/ESP32-C3_IR_BLE_receiver)